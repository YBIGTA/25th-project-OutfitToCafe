{% extends "coplate_base/base_with_navbar.html" %}

{% load widget_tweaks %}

{% block title %}
{% if dripshot %}{{ dripshot.title }}{% else %}새 리뷰 작성{% endif %} | Drip-Shot
{% endblock title %}

{% block content %}
<main class="site-body">
  <form class="review-form max-content-width" method="post" autocomplete="off" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="title">
      {{ form.title|add_class:"cp-input"|add_error_class:"error"|attr:"placeholder:제목" }}
      {% for error in form.title.errors %}
        <div class="error-message">{{ error }}</div>
      {% endfor %}
    </div>
    <div class="cafe-autocomplete">
      {{ form.cafe|add_class:"cp-input"|add_error_class:"error"|attr:"placeholder:카페를 선택해주세요" }}
      {% for error in form.cafe.errors %}
        <div class="error-message">{{ error }}</div>
      {% endfor %}
    </div>
    <div class="content">
      {{ form.content|add_class:"cp-input"|add_error_class:"error"|attr:"placeholder:" }}
      {% for error in form.content.errors %}
        <div class="error-message">{{ error }}</div>
      {% endfor %}
    </div>
    
    <!-- <div class="rating">
      <div class="cp-stars">
        {% for radio in form.rating %}
          {{ radio }}
        {% endfor %}
      </div>
      {% for error in form.rating.errors %}
        <div class="error-message">{{ error }}</div>
      {% endfor %}
    </div> -->
		<div class="file">
      <div class="file-content">
        {% if dripshot.image1 %}
          <img src="{{ dripshot.image1.url }}">
        {% endif %}
        <div>  
          {{ form.image1 }}
          {% for error in form.image1.errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="file">
      <div class="file-content">
        {% if dripshot.image2 %}
          <img src="{{ dripshot.image2.url }}">
        {% endif %}
        <div>
          {{ form.image2 }}
          {% for error in form.image2.errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="file">
      <div class="file-content">
        {% if dripshot.image3 %}
          <img src="{{ dripshot.image3.url }}">
        {% endif %}
        <div>
          {{ form.image3 }}
          {% for error in form.image3.errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="file">
      <div class="file-content">
        {% if dripshot.image4 %}
          <img src="{{ dripshot.image4.url }}">
        {% endif %}
        <div>
          {{ form.image4 }}
          {% for error in form.image4.errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="file">
      <div class="file-content">
        {% if dripshot.image5 %}
          <img src="{{ dripshot.image5.url }}">
        {% endif %}
        <div>
          {{ form.image5 }}
          {% for error in form.image5.errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="buttons">
      <a 
        class="cp-button secondary cancel" 
        href="{% if review %}{% url 'review-detail' review.id %}{% else %}{% url 'index' %}{% endif %}"
      >
        취소
      </a>
      <button class="cp-button submit" type="submit">완료</button>
    </div>
  </form>
</main>
{% endblock content %}

{% block js %}
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script>
  $(document).ready(function() {
    $('#cafe-autocomplete').autocomplete({
      source: function(request, response) {
        $.ajax({
          url: "{% url 'cafe-autocomplete' %}",  // Ajax 요청을 보낼 URL
          dataType: "json",
          data: {
            term: request.term  // 사용자가 입력한 값을 term으로 전송
          },
          success: function(data) {
            response(data);  // 받은 데이터를 response로 반환하여 자동 완성 목록에 표시
          }
        });
      },
      minLength: 2,  // 최소 2글자 입력 시 검색 시작
      select: function(event, ui) {
        $('#cafe-autocomplete').val(ui.item);  // 선택된 항목을 입력 필드에 설정
        return false;  // 기본 이벤트를 막고 수동으로 값을 설정
      }
    });
  });
</script>
{% endblock js %}
